#!/usr/bin/env bash
set -euo pipefail
__prevEnv__="$(env)"

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
export NX_WORKSPACE_ROOT=${DIR}

PATH_add node_modules/.bin

export FIXTURE_DIR="${NX_WORKSPACE_ROOT}/tests/fixtures"

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
export WORKSPACE_NAME="saito"
export LOG_LEVEL="debug"
export NODE_ENV="development"
export API_PORT=8716
export API_SERVER_BASE_PATH=""
export SIGHTAI_BACKEND_URL="http://localhost:8716"
export ENABLE_DEBUG_INFO=true

# -----------------------------------------------------------------------------
# Model Inference Framework Configuration
# -----------------------------------------------------------------------------
export MODEL_INFERENCE_FRAMEWORK="ollama"

# Ollama Configuration
export OLLAMA_API_URL="http://127.0.0.1:11434/"
export OLLAMA_MODEL="deepscaler"

# vLLM Configuration
export VLLM_API_URL="http://localhost:8000"
export VLLM_MODEL="microsoft/DialoGPT-medium"
export VLLM_PORT="8000"
export VLLM_HOST="0.0.0.0"
export VLLM_GPU_MEMORY_UTILIZATION="0.9"
export VLLM_MAX_MODEL_LEN="4096"

# -----------------------------------------------------------------------------
# Network & Gateway Configuration
# -----------------------------------------------------------------------------
export GATEWAY_API_URL="http://localhost:3000"

# -----------------------------------------------------------------------------
# Node & Blockchain Configuration
# -----------------------------------------------------------------------------
export NODE_DATABASE_URL=""

if [[ -f .envrc.override ]]; then
  source_env .envrc.override
fi

# export updated ENV of this file
node "${NX_WORKSPACE_ROOT}/tools/bin/get-env" "${__prevEnv__}" "$(env)" >"${NX_WORKSPACE_ROOT}/.env" &
