# Sight AI CLI 使用示例和最佳实践

## 快速开始指南

### 第一次使用

1. **构建和运行 CLI**
```bash
cd backend/packages/apps/cli-tool
npm run build
node dist/main.js
```

2. **注册设备到网关**
```bash
sight-cli register
```
按提示输入：
- 网关 URL: `https://gateway.example.com`
- 节点代码: `your-node-code`
- API 密钥: `your-api-key`
- 奖励地址: `your-reward-address`

3. **拉取和启动模型**
```bash
sight-cli model
# 选择 "拉取新模型" → 输入 "llama2:7b"
# 选择 "启动模型" → 选择刚下载的模型
```

4. **检查运行状态**
```bash
sight-cli status
# 选择 "查看当前状态"
```

## 详细使用示例

### 网关注册管理示例

#### 场景1：首次注册
```bash
$ sight-cli register

╔═══════════════════════════════════════════════════════════╗
║                  Sight AI 交互式 CLI 工具                  ║
║                        v1.0.0                            ║
╠═══════════════════════════════════════════════════════════╣
║  功能：                                                   ║
║  • 🔗 网关注册管理                                        ║
║  • 🤖 模型上报管理                                        ║
║  • 📊 运行状态监控                                        ║
║  • 📋 日志查看管理                                        ║
╚═══════════════════════════════════════════════════════════╝

🔗 网关注册管理
═══════════════

ℹ 未找到注册信息，开始新的注册流程

📝 新设备注册
═══════════════

ℹ 请输入网关注册信息：
? 网关 URL: https://gateway.sightai.com
? 节点代码: NODE001
? 网关 API 密钥: sk-1234567890abcdef
? 奖励地址: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa
? API 服务器基础路径: (http://localhost:8716) 

📋 注册信息确认
┌──────────────────────────────────────────────────────────┐
│  网关 URL : https://gateway.sightai.com                 │
│  节点代码 : NODE001                                      │
│  奖励地址 : 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa           │
│  API 基础路径 : http://localhost:8716                    │
└──────────────────────────────────────────────────────────┘

? 确认注册信息是否正确？ Yes
✅ 🎉 设备注册成功！
ℹ 您现在可以使用以下命令：
ℹ • sight-cli model - 管理模型
ℹ • sight-cli status - 查看运行状态
```

#### 场景2：重新注册现有设备
```bash
$ sight-cli register

📋 当前注册信息
┌──────────────────────────────────────────────────────────┐
│  网关 URL : https://gateway.sightai.com                 │
│  节点代码 : NODE001                                      │
│  奖励地址 : 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa           │
│  上次注册 : 2024-01-15 10:30:25                         │
└──────────────────────────────────────────────────────────┘

? 选择操作： 🔄 重新注册（使用现有信息）
? 确认使用保存的信息重新注册设备？ Yes
✅ 🎉 设备重新注册成功！
```

### 模型管理示例

#### 场景1：拉取和启动模型
```bash
$ sight-cli model

🤖 模型上报管理
═══════════════

? 选择操作： ⬇️ 拉取新模型

⬇️ 拉取新模型
═══════════════

ℹ 常用模型推荐：
ℹ • llama2:7b - 轻量级通用模型
ℹ • llama2:13b - 中等规模通用模型
ℹ • codellama:7b - 代码生成模型
ℹ • mistral:7b - 高效能模型
ℹ • deepseek-coder:6.7b - 代码专用模型

? 输入要拉取的模型名称: llama2:7b
? 确认拉取模型 llama2:7b？ Yes
⠋ 正在拉取模型 llama2:7b...
✅ 🎉 模型 llama2:7b 拉取成功！

# 接下来启动模型
? 选择操作： ▶️ 启动模型（上报）
? 选择要启动的模型： llama2:7b (3.8GB)
⠋ 正在启动模型...
✅ 🎉 模型 llama2:7b 已成功启动！
ℹ 模型现在可以接收任务了
```

#### 场景2：查看模型状态
```bash
$ sight-cli model

? 选择操作： 📋 查看本地模型

📋 本地模型列表
═══════════════

┌─────────────────┬─────────┬──────────────────┬────────┐
│ 模型名称        │ 大小    │ 修改时间         │ 格式   │
├─────────────────┼─────────┼──────────────────┼────────┤
│ llama2:7b       │ 3.8GB   │ 2024-01-15 10:45 │ gguf   │
│ codellama:7b    │ 3.8GB   │ 2024-01-14 15:20 │ gguf   │
│ mistral:7b      │ 4.1GB   │ 2024-01-13 09:15 │ gguf   │
└─────────────────┴─────────┴──────────────────┴────────┘

ℹ 总共找到 3 个模型

? 选择操作： ⏹️ 查看运行中的模型

🔄 运行状态
┌──────────────────────────────────────────────────────────┐
│ ✅ llama2:7b : running (内存: 2.1GB)                     │
│ ⚠️ codellama:7b : idle                                   │
└──────────────────────────────────────────────────────────┘
```

### 状态监控示例

#### 场景1：查看当前状态
```bash
$ sight-cli status

📊 运行状态监控
═══════════════

? 选择操作： 📈 查看当前状态

⠋ 获取状态信息...
✅ 状态信息获取成功

🔧 服务状态
┌──────────────────────────────────────────────────────────┐
│ ✅ 后端服务 : 运行中                                     │
│ ✅ Ollama 服务 : 运行中                                  │
│ ✅ 网关连接 : 已连接                                     │
└──────────────────────────────────────────────────────────┘

💻 系统资源
┌──────────────────────────────────────────────────────────┐
│ ✅ CPU 使用率 : 25%                                      │
│  CPU 型号 : Intel Core i7-10700K                        │
│ ✅ 内存使用率 : 45% (7.2GB/16GB)                         │
│ ⚠️ 磁盘使用率 : 85% (850GB/1TB)                          │
└──────────────────────────────────────────────────────────┘

🎮 GPU 信息
┌──────────────────────────────────────────────────────────┐
│  GPU 1 : NVIDIA RTX 3080 (10GB)                         │
└──────────────────────────────────────────────────────────┘

⛏️ 矿工状态
┌──────────────────────────────────────────────────────────┐
│ ✅ 设备状态 : connected                                  │
│  设备 ID : a1b2c3d4...                                   │
│  完成任务 : 127 个                                       │
│  累计收益 : 45.67 SAITO                                  │
└──────────────────────────────────────────────────────────┘
```

#### 场景2：实时监控
```bash
$ sight-cli status

? 选择操作： 🔄 实时监控

🔄 实时监控设置
═══════════════

? 监控更新间隔（秒）: 5
ℹ 启动实时监控...
ℹ 提示：按 Ctrl+C 可以停止监控
按任意键开始监控...

[实时更新的状态信息每5秒刷新一次]
```

### 日志管理示例

#### 场景1：交互式日志查看
```bash
$ sight-cli logs

📋 日志管理
═══════════

? 选择操作： 📖 查看日志

? 选择日志类型： 后端服务日志
? 显示行数： 50

📖 后端服务日志 (最近 50 条)
═══════════════════════════════

2024-01-15 10:45:23 [INFO] Server started on port 8716
2024-01-15 10:45:24 [INFO] Database connection established
2024-01-15 10:45:25 [INFO] Gateway connection established
2024-01-15 10:46:01 [INFO] Model llama2:7b started successfully
2024-01-15 10:46:15 [INFO] Task received from gateway
2024-01-15 10:46:18 [INFO] Task completed successfully
...
```

#### 场景2：命令式日志操作
```bash
# 查看最近100条CLI日志
$ sight-cli logs view cli -n 100

# 搜索后端日志中的错误
$ sight-cli logs search backend "error" -n 200

🔍 搜索结果 (关键词: "error", 3 条):
────────────────────────────────────────────────────────────────────────────────
2024-01-15 09:30:15 [ERROR] Failed to connect to gateway: Connection timeout
2024-01-15 09:45:22 [ERROR] Model loading failed: Insufficient memory
2024-01-15 10:15:33 [ERROR] Task execution failed: Model not responding
────────────────────────────────────────────────────────────────────────────────

# 查看日志统计
$ sight-cli logs stats

📊 所有日志统计:
══════════════════════════════════════════════════

CLI日志:
  总数: 45 条
  错误: 2 条
  警告: 5 条
  今日: 23 条

后台服务日志:
  总数: 156 条
  错误: 8 条
  警告: 12 条
  今日: 67 条

系统日志:
  总数: 89 条
  错误: 3 条
  警告: 7 条
  今日: 34 条

══════════════════════════════════════════════════
```

## 最佳实践

### 1. 日常运维流程

**每日检查：**
```bash
# 1. 检查整体状态
sight-cli status

# 2. 查看运行中的模型
sight-cli model
# 选择 "查看运行中的模型"

# 3. 检查最近的错误日志
sight-cli logs search backend "error" -n 50
sight-cli logs search system "error" -n 50
```

**定期维护：**
```bash
# 1. 清理旧日志（每周）
sight-cli logs clean

# 2. 检查磁盘空间
sight-cli status
# 选择 "系统信息"

# 3. 更新模型（按需）
sight-cli model
# 选择 "拉取新模型"
```

### 2. 故障排除流程

**服务异常时：**
```bash
# 1. 检查服务状态
sight-cli status
# 选择 "服务状态"

# 2. 查看相关错误日志
sight-cli logs search backend "error" -n 100

# 3. 重新注册（如果网关连接异常）
sight-cli register
# 选择 "重新注册"
```

**模型问题时：**
```bash
# 1. 检查 Ollama 服务
sight-cli status
# 选择 "服务状态"

# 2. 查看模型状态
sight-cli model
# 选择 "查看运行中的模型"

# 3. 重启模型
sight-cli model
# 选择 "启动模型"
```

### 3. 性能优化建议

1. **监控系统资源**
   - 定期检查 CPU、内存、磁盘使用率
   - 当内存使用率超过 80% 时考虑重启模型
   - 磁盘使用率超过 90% 时清理日志和缓存

2. **模型管理**
   - 根据硬件配置选择合适的模型大小
   - 避免同时运行多个大型模型
   - 定期更新模型到最新版本

3. **日志管理**
   - 定期清理旧日志文件
   - 使用搜索功能快速定位问题
   - 关注错误和警告日志的趋势

### 4. 安全注意事项

1. **配置文件保护**
   - 确保 `~/.sightai/config.json` 文件权限正确
   - 不要在公共场所显示 API 密钥

2. **网络安全**
   - 使用 HTTPS 连接网关
   - 定期更新 API 密钥
   - 监控异常连接活动

3. **系统安全**
   - 保持系统和依赖包更新
   - 定期备份配置文件
   - 监控系统资源异常使用
